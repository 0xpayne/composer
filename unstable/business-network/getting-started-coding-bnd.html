<!doctype html>
<html lang="en">
  
  
  

<head>
  <meta charset="utf-8">
  
    <title>Getting Started with coding a Business Network Definition | Hyperledger Composer</title>
  
  <meta name="viewport" content="width=device-width">
  <link rel="icon" type="image/x-icon" href="/composer/unstable/favicon.ico">
  <meta name="google-site-verification" content="fBQRJ6h7MV7_TJ7grbgq4P-d-07NRfDWPe4pqEEoH5w">
  <link href="//fonts.googleapis.com/css?family=Roboto+Slab:400,700%7CRoboto:400,700,700italic,400italic" rel="stylesheet" type="text/css">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
   <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet">
  <script src="/composer/unstable/assets/js/clipboard.min.js"></script>

  
    <!-- Google Analytics -->
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-91314349-2', 'auto');
ga('require', 'outboundLinkTracker');
ga('require', 'eventTracker');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script async src="/composer/unstable/assets/js/autotrack.js"></script>
<!-- End Google Analytics -->

  

  
    <link href="/composer/unstable/assets/css/normalize.css" rel="stylesheet">
    <link href="/composer/unstable/assets/css/main.css" rel="stylesheet">
    <link href="/composer/unstable/assets/css/footer.css" rel="stylesheet">
    <link href="/composer/unstable/assets/css/prettify.css" rel="stylesheet">
    <link href="/composer/unstable/assets/css/bootstrap.css" rel="stylesheet">
    <link href="/composer/unstable/assets/css/composer-style.css" rel="stylesheet">
    <link href="/composer/unstable/assets/css/new-style.min.css" rel="stylesheet">
  
</head>


<body class="">

  
  <!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/composer/unstable/index.html"><b>Hyperledger</b> Composer</a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- <li>
                    <a href="services.html">Composer</a>
                </li> -->
                <li>
                    <a href="https://composer-playground.mybluemix.net/">Playground</a>
                </li>
                <li>
                    <a href="../tutorials/tutorialindex.html">Tutorials</a>
                </li>
                <li>
                    <a href="../introduction/introduction.html">Docs</a>
                </li>
                <li>
                    <a href="../support/index.html">Community</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container
   -->
</nav>

  

  <div class="SiteWrapper">
    
      <div class="content">
    <article class="container">
      <div class="row">
        <!-- If there's a sidebar, divide into 2 columns -->
        
        <div class="col-md-3">
          <nav class="context-nav" id="myScrollspy">
            
            
              <p><strong><a href="../introduction/introduction.html">Introduction</a></strong>
<strong><a href="../tutorials/tutorialindex.html">Tutorials</a></strong>
<strong><a href="../installing/installingindex.html">Installing</a></strong>
<strong><a href="../business-network/businessnetwork.html">Defining Business Networks</a></strong>
<a href="../business-network/businessnetwork.html">What is a business network?</a>
<a href="../business-network/businessnetworkdefinition.html">What is a business network definition?</a>
<a href="../business-network/getting-started-coding-bnd.html">Defining a business network</a>
<a href="../business-network/deploybusinessnetwork.html">Deploying a business network</a>
<a href="../business-network/bnd-define.html">Create a business network definition</a>
<a href="../business-network/bnd-publish.html">Publish a business network definition</a>
<a href="../business-network/model-publish.html">Publish a business domain model</a>
<a href="../business-network/runtime-update.html">Update a business network definition on Composer</a>
<a href="../business-network/testing.html">Test a business network definition</a>
<strong><a href="../applications/genapp.html">Writing Applications</a></strong>
<strong><a href="../integrating/integrating-index.html">Integrating Existing Systems</a></strong>
<strong><a href="../managing/managingindex.html">Managing and Operating</a></strong>
<strong><a href="../problems/diagnostics.html">Determining Problems</a></strong>
<strong><a href="../reference/MeetTheModules.html">Reference</a></strong>
<strong><a href="../support/index.html">Support</a></strong></p>

            
          </nav>
        </div>
        <div class="col-md-9">
          <section class="content-chunk">
            
              <h1 id="coding-and-deploying-a-business-network-definition">Coding and deploying a business network definition</h1>

<hr>

<p>This tutorial will take you through how to code and deploy a Business Network Definition. How to put together the files, code required artifacts, and what to do with them.</p>

<p>The final form of the Business Network Archive (<code>.bna</code>) is mandatory for Hyperledger Composer. However, the creation and management of the input files is not mandatory.</p>

<p>For this tutorial, a single NPM module will be created for both the model and transaction functions. An archive will be created locally  and deployed. The NPM module consists of your business network definition, and the <code>package.json</code> file.</p>

<h2 id="before-you-begin">Before you begin</h2>

<p>Typically, a business network would be deployed after fully modelling and testing a business network definition. For this tutorial we are going to continue to use the Digital Property Network sample business network, using only the model file and the transction function file.</p>

<p>You will need the Composer command line tools. To install the tools run the following command:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>npm install -g composer-cli
</code></pre></div>
<p><em>Please note: When using Ubuntu this command will fail when running in a root user shell.</em></p>

<p>You will also require a running Hyperledger Fabric. For more information on setting up an instance of Hyperledger Fabric, see the <a href="">Fabric documentation</a><em>fill this in</em></p>

<h1 id="creating-the-npm-module">Creating the npm module.</h1>

<h2 id="creating-the-basic-infrastrure">Creating the basic infrastrure</h2>

<ol>
<li><p>Ensure that you have a new clean working directory by using the following command:</p>
<div class="highlight"><pre><code class="language-" data-lang="">```bash
$ mkdir property-network &amp;&amp; cd property-network &amp;&amp; pwd
/home/matthew/property-network
```
</code></pre></div></li>
<li><p>Now we need to setup the NPM module. The default values can be accepted, but you are welcome to change any that you wish.</p>
<div class="highlight"><pre><code class="language-" data-lang="">```bash
$ npm init
This utility will walk you through creating a package.json file.
It only covers the most common items, and tries to guess sensible defaults.

See `npm help json` for definitive documentation on these fields
and exactly what they do.

Use `npm install &lt;pkg&gt; --save` afterwards to install a package and save it as a dependency in the package.json file.

Press ^C at any time to quit.
name: (property-network)
version: (1.0.0)
description:
entry point: (index.js)
test command:
git repository:
keywords:
author:
license: (ISC)
About to write to /home/matthew/property-network/package.json:

{
  "name": "property-network",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1"
  },
  "author": "",
  "license": "ISC"
}

Is this ok? (yes) yes
```
</code></pre></div></li>
</ol>

<p>The infrastructure is now in place, the model and transaction functions can now be added.</p>

<h2 id="creating-your-model-file">Creating your model file</h2>

<p>The model file defines the assets, participants, and transactions in your business network. It is a simple text file that follows a defined syntax.</p>

<ol>
<li><p>Create the model (<code>.cto</code>) file:</p>
<div class="highlight"><pre><code class="language-" data-lang="">```bash
$ touch models/DigitalLandTitle.cto
```
</code></pre></div></li>
<li><p>Open the model file in an editor of your choice and add your own model, or copy in the code below. The following code is the DigitalLandTitle getting started example.</p>
<div class="highlight"><pre><code class="language-" data-lang="">```
/**  A 'Getting Started Tutorial' to work with Hyperledger Composer
*/

namespace net.biz.digitalPropertyNetwork

asset LandTitle identified by titleId {
  o String   titleId
  --&gt; Person   owner
  o String   information
  o Boolean  forSale   optional
}

asset SalesAgreement identified by salesId {
  o String    salesId
  --&gt; Person    buyer
  --&gt; Person    seller
  --&gt; LandTitle title
}

participant Person identified by personId {
  o String personId
  o String firstName
  o String lastName
}

transaction RegisterPropertyForSale identified by transactionId{
  o String transactionId
  --&gt; Person seller
  --&gt; LandTitle title
}
```
</code></pre></div></li>
</ol>

<h2 id="creating-transaction-processor-functions">Creating transaction processor functions</h2>

<p>The transaction processor function file is a standard JavaScript file that defines the operation of your transactions.</p>

<ol>
<li><p>Create a blank JavaScript file.</p>
<div class="highlight"><pre><code class="language-" data-lang="">```bash
$ touch lib/DigitalLandTitle.js
```
</code></pre></div></li>
<li><p>Open the transaction processor file in an editor of your choice. Enter either the JavaScript for your own transactions, or use the following JavaScript sample. This sample is the  <code>registeryPropertyForSale</code> transaction.</p>
<div class="highlight"><pre><code class="language-" data-lang="">```javascript
'use strict';

/**
 * Process a property that is held for sale
 * @param {net.biz.digitalPropertyNetwork.RegisterPropertyForSale} propertyForSale the property to be sold
 * @transaction
 */
function onRegisterPropertyForSale(propertyForSale) {
    console.log('### onRegisterPropertyForSale ' + propertyForSale.toString());
    propertyForSale.title.forSale = true;

    returAssetRegistry('net.biz.digitalPropertyNetwork.LandTitle').then(function(result) {
            return result.update(propertyForSale.title);
        }
    );
}
```
</code></pre></div></li>
</ol>

<p>Now that the <code>package.json</code> file has been created in addition to the business network definition, the npm module for the business network has been created. The next step is to form this into a business network archive (<code>.bna</code>) file to be depoloyed to an instance of Hyperledger Fabric.</p>

<hr>

<h1 id="creating-the-business-network-archive-and-deploying-to-hyperledger-fabric">Creating the business network archive and deploying to Hyperledger Fabric</h1>

<p>Now that the business network has been defined, a business network archive must be created. This requires all the files in the business network definition created above. The business network archive (<code>.bna</code>) file can then be deployed to Hyperledger Fabric.</p>

<p>There is a <code>composer archive</code> command that can be used to create and inspect these archives. The <code>composer network</code> command is then used to administer the business network archive on the Hyperledger Fabric.</p>

<ol>
<li>Use the <code>composer archive create</code> command to create the archive. The <code>--archiveFile</code> option is used to specify the name of the archive file to create. If no filename is specified, a default name will be created  based on the identifier of the business network (sanitized to be suitable as a filename). For example <code>digitalPropertyNetwork-0.1.2.bna</code>.</li>
</ol>

<p>There are two options that control where the inputs for the archive create from.</p>

<ul>
<li><code>--sourceType</code> can either be <code>dir</code> or <code>module</code>. Specifying <code>dir</code> implies that the source is from a directory. Specifying <code>module</code> indicates that the source is an installed NPM module.</li>
<li><code>--sourceName</code> is either the directory name or the NPM module name as appropriate.</li>
</ul>

<p>In the case of a directory being given, this directory must contain the appropriate <code>package.json</code> file.</p>
<div class="highlight"><pre><code class="language-" data-lang="">    ```bash
    $ composer archive create --archiveFile digitalLandTitle.bna --sourceType dir --sourceName .
    ```
</code></pre></div>
<ol>
<li><p>To deploy an archive file Once you have this archive it can then be deployed to Hyperledger (which will assuming is all running for the moment)</p>
<div class="highlight"><pre><code class="language-" data-lang="">```bash
$ composer network deploy --archiveFile  DigitalLandTitle.bna  --enrollId WebAppAdmin --enrollSecret DJY27pEnl16d
```
</code></pre></div></li>
</ol>

<h1 id="next-steps-to-develop-the-model-or-transaction-processor-functions">Next steps to develop the model or transaction processor functions</h1>

<p>The next step in the development process would be to update either the model or transaction functions or both. When you&#39;ve done this, the steps are to recreate the archive and then redeploy the network.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>composer archive create --archiveFile digitalLandTitle.bna ---sourceType dir --sourceName .
<span class="gp">$ </span>composer network update --archiveFile digitalproperty-network@0.0.1.bna  --enrollId WebAppAdmin --enrollSecret DJY27pEnl16d
</code></pre></div>
<h1 id="complete">Complete!</h1>

<p>This tutorial is now complete. The next step would be to create a REST API for applications to use. The <a href="../applications/genapp.html">next step</a> will create a REST api for the Digital Property Network.</p>

            
          </section>
        </div>
        <!-- Otherwise, have the main content fill all 12 columns... -->
        
      </div>
      <div class="PageNavigation">
    
    
  </div>
    </article>
</div>

    

    
    <div class="footer-bg docs-footer">
<div class="footer-container">
    <div class="footer-left">
      <p>Released under the Apache License v2.0</p>
    </div>
  <div class="footer-right">
    <ul>
      <li><a href="https://github.com/hyperledger/composer">GitHub</a></li>
      <!-- <li><a href="https://github.com/hyperledger/composer/LICENSE.txt">Legal</a></li> -->
      <li><a href="/composer/unstable/jsdoc/index.html">APIs</a></li>
      <li><a href="http://stackoverflow.com/questions/tagged/fabric-composer">Stack Overflow</a></li>
      <li><a href="https://goo.gl/forms/7YPMLP2LTN2hjIRk2">Feedback?</a></li>
    </ul>
  </div>
</div>
</div>

    
  </div>
</body>

<!-- jQuery -->
<script src="/composer/unstable/assets/js/jquery.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/composer/unstable/assets/js/bootstrap.js"></script>

<script>

  $( document ).ready(function() {

      new Clipboard('.btn', {
    text: function() {

        return document.querySelector("[style='display:none;']").value;
    }
});
  });

</script>

</html>
