<!doctype html>
<html lang="en">
  
  
  

<head>
  <meta charset="utf-8">
  
    <title>Calling REST APIs | Hyperledger Composer</title>
  
  <meta name="viewport" content="width=device-width">
  <link rel="icon" type="image/x-icon" href="/composer/unstable/favicon.ico">
  <meta name="google-site-verification" content="fBQRJ6h7MV7_TJ7grbgq4P-d-07NRfDWPe4pqEEoH5w">
  <link href="//fonts.googleapis.com/css?family=Roboto+Slab:400,700%7CRoboto:400,700,700italic,400italic" rel="stylesheet" type="text/css">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
   <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet">
  <script src="/composer/unstable/assets/js/clipboard.min.js"></script>

  
    <!-- Google Analytics -->
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-91314349-2', 'auto');
ga('require', 'outboundLinkTracker');
ga('require', 'eventTracker');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script async src="/composer/unstable/assets/js/autotrack.js"></script>
<!-- End Google Analytics -->

  

  
    <link href="/composer/unstable/assets/css/normalize.css" rel="stylesheet">
    <link href="/composer/unstable/assets/css/main.css" rel="stylesheet">
    <link href="/composer/unstable/assets/css/footer.css" rel="stylesheet">
    <link href="/composer/unstable/assets/css/prettify.css" rel="stylesheet">
    <link href="/composer/unstable/assets/css/bootstrap.css" rel="stylesheet">
    <link href="/composer/unstable/assets/css/composer-style.css" rel="stylesheet">
    <link href="/composer/unstable/assets/css/new-style.min.css" rel="stylesheet">
  
</head>


<body class="">

  
  <!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/composer/unstable/index.html"><b>Hyperledger</b> Composer</a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- <li>
                    <a href="services.html">Composer</a>
                </li> -->
                <li>
                    <a href="https://composer-playground.mybluemix.net/">Playground</a>
                </li>
                <li>
                    <a href="../tutorials/tutorials.html">Tutorials</a>
                </li>
                <li>
                    <a href="../introduction/introduction.html">Docs</a>
                </li>
                <li>
                    <a href="../support/index.html">Community</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container
   -->
</nav>

  

  <div class="SiteWrapper">
    
      <div class="content">
    <article class="container">
      <div class="row">
        <!-- If there's a sidebar, divide into 2 columns -->
        
        <div class="col-md-3">
          <nav class="context-nav" id="myScrollspy">
            
            
              <p><strong><a href="../introduction/introduction.html">Introduction</a></strong>
<strong><a href="../getting-started/getting-started.html">Installing</a></strong>
<strong><a href="../tutorials/tutorials.html">Tutorials</a></strong>
<strong><a href="../business-network/businessnetwork.html">Developing Business Networks</a></strong>
<strong><a href="../applications/genapp.html">Developing Applications</a></strong>
<strong><a href="../integrating/integrating-index.html">Integrating Existing Systems</a></strong>
<a href="../integrating/getting-started-rest-api.html">Exposing your business network as a REST API</a>
<a href="../integrating/enabling-rest-authentication.html">Enabling REST API authentication for a business network</a>
<a href="../integrating/deploying-the-rest-server.html">Deploying the REST server for a business network</a>
<a href="../integrating/call-out.html">Calling external REST services</a>
<strong><a href="../managing/managingindex.html">Managing and Operating</a></strong>
<strong><a href="../problems/diagnostics.html">Diagnosing Problems</a></strong>
<strong><a href="../reference/MeetTheModules.html">Reference</a></strong>
<strong><a href="../support/index.html">Support</a></strong></p>

            
          </nav>
        </div>
        <div class="col-md-9">
          <section class="content-chunk">
            
              <h1 id="calling-a-rest-api-from-transaction-processor-functions">Calling a REST API from Transaction Processor Functions</h1>

<hr>

<blockquote>
<p>The status of this feature is experimental. We welcome your feedback on the utility of this feature. We may evolve the feature in the future to make it more generally useful. While we will strive to ensure backwards compatability this cannot be guaranteed.</p>
</blockquote>

<h2 id="scenario">Scenario</h2>

<p>In some cases it is desireable to be able to call REST APIs from transaction processor functions. This allows you to move complex computation off the blockchain. This allows the TP functions to off-board complex or expensive computation to a centrally or peer hosted service.</p>

<h2 id="calling-an-external-rest-service">Calling an External REST Service</h2>

<p>The <code>post(url,data)</code> function is available to transaction processor functions, allowing them to pass a concept, transaction, asset or participant to an external service. The data is serialized to JSON and the data is sent to the url using an HTTP POST using the <code>application/json</code> content encoding.</p>

<p>Note that the <code>post</code> function is supported in all runtime environments: web (playground), Node.js (embedded), HLF v0.6 and HLF v1.0.</p>

<h2 id="handling-results">Handling Results</h2>

<p>The <code>post</code> method returns a <code>Promise</code> to a JS Object that contains the results returned by the remote server. The JS Object has the following properties:</p>

<ul>
<li>statusCode : the HTTP statusCode</li>
<li>body : the HTTP response body</li>
</ul>

<p>Note that HTTP response codes from 200 to 300 are returned as a resolved Promise, while any other response codes cause the Promise to be rejected. Rejected promises may be handled using a <code>.catch</code> Promise handler.</p>

<p>The <code>body</code> property of the response is automatically converted to a JS Object if possible, otherwise it is returned as a <code>string</code>.</p>

<p>Transaction processor functions may optionally call the <code>getSerializer().fromJSON(object)</code> function to convert a reponse body JS Object back into a Composer asset/participant/transaction. </p>

<h2 id="examples">Examples</h2>
<div class="highlight"><pre><code class="language-" data-lang="">/**
 * Handle a POST transaction, calling Node-RED running on Bluemix
 * @param {org.acme.sample.PostTransaction} postTransaction - the transaction to be processed
 * @transaction
 * @return {Promise} a promise that resolves when transaction processing is complete
 */
function handlePost(postTransaction) {
    var url = 'https://composer-node-red.mybluemix.net/compute';

    return post( url, postTransaction)
      .then(function (result) {
        // alert(JSON.stringify(result));
          postTransaction.asset.value = 'Count is ' + result.body.sum;
          return getAssetRegistry('org.acme.sample.SampleAsset')
          .then(function (assetRegistry) {
              return assetRegistry.update(postTransaction.asset);
          });
      });
}
</code></pre></div>
<h2 id="idempotency-and-consensus">Idempotency and Consensus</h2>

<p>The result of the REST request should be a pure function (idempotent) to ensure that all peers get the same results with the same inputs. If this restriction is honored then the risk of consensus failure is minimised.</p>

<p><em>Each</em> peer will make a call to the REST service.</p>

<h2 id="cors">CORS</h2>

<p>HTTP requests from the web browser will need to be CORS compliant. This requires the server be setup to receive the OPTIONS method and return appropriate headers.</p>

<h2 id="docker-network-resolution">Docker Network Resolution</h2>

<p>HTTP request from the HLF chain code container require DNS resolution and network are in place. For example, with the default Docker container one cannot use <a href="http://localhost">http://localhost</a> as this does not resolve to the host machine inside the Docker container. The easiest workaround is to use a DNS name that is publicly resolvable.</p>

            
          </section>
        </div>
        <!-- Otherwise, have the main content fill all 12 columns... -->
        
      </div>
      <div class="PageNavigation">
    
    
  </div>
    </article>
</div>

    

    
    <div class="footer-bg docs-footer">
<div class="footer-container">
    <div class="footer-left">
      <p>Released under the Apache License v2.0</p>
    </div>
  <div class="footer-right">
    <ul>
      <li><a href="https://github.com/hyperledger/composer">GitHub</a></li>
      <!-- <li><a href="https://github.com/hyperledger/composer/LICENSE.txt">Legal</a></li> -->
      <li><a href="/composer/unstable/jsdoc/index.html">APIs</a></li>
      <li><a href="http://stackoverflow.com/questions/tagged/fabric-composer">Stack Overflow</a></li>
      <li><a href="https://goo.gl/forms/7YPMLP2LTN2hjIRk2">Feedback?</a></li>
    </ul>
  </div>
</div>
</div>

    
  </div>
</body>

<!-- jQuery -->
<script src="/composer/unstable/assets/js/jquery.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/composer/unstable/assets/js/bootstrap.js"></script>

<script>

  $( document ).ready(function() {

      new Clipboard('.btn', {
    text: function() {

        return document.querySelector("[style='display:none;']").value;
    }
});
  });

</script>

</html>
